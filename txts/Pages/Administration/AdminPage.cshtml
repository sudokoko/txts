@page "/admin"
@using txts.Types.Entities
@model txts.Pages.Administration.AdminPage

@{
    Layout = "Layouts/PageLayout";

    Model.Title = "Site Administration";
}

<div>
    @switch (Model.Callback)
    {
        case "ban":
            <div class="success-message">
                Page banned successfully.
            </div>
            break;
        case "unban":
            <div class="success-message">
                Page unbanned successfully.
            </div>
            break;
        case "error":
            <div class="error-message">
                An error occurred while processing your request.
            </div>
            break;
    }

    <div class="secondary-container">
        <div style="display: flex; flex-direction: row;">
            <button onclick="window.location.href = '/admin/manage?action=cleanSessions&id=0'">Clean Up Sessions</button>
            <form method="GET" action="/admin" style="margin-left: auto;">
                <input type="text" name="search" placeholder="Search pages and bans" style="margin: 0;"/>
            </form>
        </div>
    </div>

    <div class="secondary-container">
        <span class="tb-padding">There are @Model.Pages.Count page(s) being displayed.</span>
        @if (Model.Pages.Count > 0)
        {
            <table>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Secret</th>
                    <th>Banned</th>
                    <th>Actions</th>
                </tr>
                @foreach (PageEntity pageEntity in Model.Pages)
                {
                    <tr>
                        <td>@pageEntity.PageId</td>
                        <td>
                            <a href="/@@@pageEntity.Username">@pageEntity.Username</a>
                        </td>
                        <td>
                            <small>@pageEntity.Secret</small>
                        </td>
                        <td>
                            @pageEntity.IsBanned
                        </td>
                        @switch (pageEntity.IsBanned)
                        {
                            case false:
                                <td>
                                    <button onclick="window.location.href = '/admin/manage?action=ban&id=@pageEntity.PageId'">ban</button>
                                </td>
                                break;
                            case true:
                                <td>
                                    <button onclick="window.location.href = '/admin/manage?action=unban&id=@pageEntity.PageId'">unban</button>
                                </td>
                                break;
                        }
                    </tr>
                }
            </table>
        }
    </div>
    <div class="secondary-container">
        <span class="tb-padding">There are @Model.Bans.Count ban(s) being displayed.</span>
        @if (Model.Bans.Count > 0)
        {
            <table>
                <tr>
                    <th>ID</th>
                    <th>Page</th>
                    <th>Reason</th>
                </tr>
                @foreach (BanEntity banEntity in Model.Bans)
                {
                    <tr>
                        <td>@banEntity.BanId</td>
                        <td>@banEntity.PageId</td>
                        <td>@banEntity.Reason</td>
                    </tr>
                }
            </table>
        }
    </div>
</div>